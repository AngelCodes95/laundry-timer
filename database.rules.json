{
  "rules": {
    "machines": {
      "$machineId": {
        ".validate": "$machineId.matches(/^(washer|dryer)_[1-4]$/)",
        ".read": true,
        ".write": "newData.exists() && newData.hasChildren(['machine_id', 'status', 'updated_at']) && newData.child('machine_id').val() === $machineId && (newData.child('status').val() === 'active' || newData.child('status').val() === 'available' || newData.child('status').val() === 'paused') && newData.child('updated_at').isNumber() && newData.child('updated_at').val() <= now + 60000",
        "machine_id": {
          ".validate": "$machineId === newData.val()"
        },
        "status": {
          ".validate": "newData.val() === 'active' || newData.val() === 'available' || newData.val() === 'paused'"
        },
        "end_time": {
          ".validate": "newData.isNumber() && newData.val() > now && newData.val() <= now + 7200000"
        },
        "updated_at": {
          ".validate": "newData.isNumber() && newData.val() <= now + 60000 && newData.val() >= now - 60000"
        },
        "duration_minutes": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 120"
        },
        "paused_time_remaining": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 120"
        },
        "paused_at": {
          ".validate": "newData.isNumber()"
        },
        "$other": {
          ".validate": false
        }
      }
    },
    "$other": {
      ".read": false,
      ".write": false
    }
  }
}
